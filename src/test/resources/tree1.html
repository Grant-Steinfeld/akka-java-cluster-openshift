<!DOCTYPE html>
<meta charset='utf-8'>
<style>

g {
  width: inherit;
  height: inherit;
}

path.link {
  fill: none;
  stroke: #2194e3;
  stroke-width: 3px;
}

text {
  font-family: sans-serif;
  font-size: 12px;
  fill: #999;
}

</style>
<svg></svg>
<script src="https://d3js.org/d3.v5.js"></script>
<script>

const width = 1600;
const height = 1200;
const radius = height / 2;
const tree = d3.tree().size([2 * Math.PI, radius - 75]);

const svg = d3.select('svg')
  .style('width', width)
  .style('height', height)
  .style('padding', '10px')
  .style('box-sizing', 'border-box')
  .style('font', 'sans-serif');

const g = svg.append('g')
  .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

const gLink = g.append('g')
    .attr('class', 'links')
    .attr('fill', 'none')
    .attr('stroke', '#555')
    .attr('stroke-opacity', '0.4')
    .attr('stroke-width', 1.5);

const gNode = g.append('g')
    .attr('class', 'nodes')
    .attr('stroke-linejoin', 'round')
    .attr('stroke-width', 3);

update((hierarchy1()));

function update(hierarchy) {
  const root = tree(d3.hierarchy(hierarchy));

  const t = d3.transition()
    .duration(500);

  const link = gLink.selectAll('path')
    .data(root.links(), linkId);

  link.exit()
    .transition(t)
    .attr('opacity', 0)
    .remove();

  link.transition(t)
    .attr('d', d3.linkRadial()
    .angle(d => d.x)
    .radius(d => d.y));

  link.enter().append('path')
    .attr('id', d => linkId)
    .attr('class', d => 'link ' + d.source.data.type)
    .attr('d', d3.linkRadial()
                 .angle(d => d.x)
                 .radius(d => d.y));

  const node = gNode.selectAll('g')
    .data(root.descendants(), nodeId);

  node.exit()
    .transition(t)
    .attr('opacity', 0)
    .remove();

  node.transition(t)
    .attr('transform', d => `rotate(${d.x * 180 / Math.PI - 90}) translate(${d.y},0)`);

  const nodeEnter = node.enter().append('g')
    .attr('id', nodeId)
    .attr('class', d => 'node ' + d.data.type)
    .attr('transform', d => `rotate(${d.x * 180 / Math.PI - 90}) translate(${d.y},0)`);

  nodeEnter.append('circle')
    .attr('fill', circleColor)
    .attr('r', circleRadius);

  nodeEnter.append('text')
    .attr('dy', '0.31em')
    .attr('x', labelOffsetX)
    .attr('text-anchor', d => d.x < Math.PI === !d.children ? 'start' : 'end')
    .attr('transform', d => d.x >= Math.PI ? 'rotate(180)' : null)
    .on('mouseover',
      function() { d3.select(this).style('font-size', 24).style('fill', '#046E97'); })
    .on('mouseout',
      function(d) { d3.select(this).style('font-size', 12).style('fill', '#999'); })
    .text(d => d.data.name);
}

function linkId(d) {
  return d.source.data.name + '-' + d.target.data.name;
}

function nodeId(d) {
  return d.data.name;
}

function circleColor(d) {
    if (d.data.type == 'cluster') {
        return '#B30000';
    } else if (d.data.type == 'member') {
        return '#F17D00';
    } else if (d.data.type == 'shard') {
        return '#00C000';
    } else if (d.data.type == 'entity') {
        return '#046E97';
    } else {
        return 'red';
    }
}

function circleRadius(d) {
    if (d.data.type == 'cluster') {
        return 10;
    } else if (d.data.type == 'member') {
        return 22;
    } else if (d.data.type == 'shard') {
        return 12;
    } else if (d.data.type == 'entity') {
        return 8;
    } else {
        return 3;
    }
}

function labelOffsetX(d) {
    if (d.data.type == 'cluster') {
        offset = 12;
    } else if (d.data.type == 'member') {
        offset = 24;
    } else if (d.data.type == 'shard') {
        offset = 14;
    } else if (d.data.type == 'entity') {
        offset = 10;
    } else {
        offset = 5;
    }
    return d.x < Math.PI === !d.children ? offset : -offset;
}

function hierarchy1() {
    return {
        'name' : 'cluster',
        'type' : 'cluster',
        'children' : [
            {
                'name' : 'member1',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard11',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity111', 'type' : 'entity' },
                            { 'name' : 'entity112', 'type' : 'entity' },
                            { 'name' : 'entity113', 'type' : 'entity' },
                            { 'name' : 'entity114', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard12',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity121', 'type' : 'entity' },
                            { 'name' : 'entity122', 'type' : 'entity' },
                            { 'name' : 'entity123', 'type' : 'entity' },
                            { 'name' : 'entity124', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member2',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard21',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity211', 'type' : 'entity' },
                            { 'name' : 'entity212', 'type' : 'entity' },
                            { 'name' : 'entity213', 'type' : 'entity' },
                            { 'name' : 'entity214', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard22',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity221', 'type' : 'entity' },
                            { 'name' : 'entity222', 'type' : 'entity' },
                            { 'name' : 'entity223', 'type' : 'entity' },
                            { 'name' : 'entity224', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member3',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard31',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity311', 'type' : 'entity' },
                            { 'name' : 'entity312', 'type' : 'entity' },
                            { 'name' : 'entity313', 'type' : 'entity' },
                            { 'name' : 'entity314', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard32',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity321', 'type' : 'entity' },
                            { 'name' : 'entity322', 'type' : 'entity' },
                            { 'name' : 'entity323', 'type' : 'entity' },
                            { 'name' : 'entity324', 'type' : 'entity' }
                        ]
                    },
                ]
            },
        ]
    }
}

setTimeout(update2, 5000);

function update2() {
  update(hierarchy2());
}

function hierarchy2() {
    return {
        'name' : 'cluster',
        'type' : 'cluster',
        'children' : [
            {
                'name' : 'member1',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard11',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity111', 'type' : 'entity' },
                            { 'name' : 'entity112', 'type' : 'entity' },
                            { 'name' : 'entity113', 'type' : 'entity' },
                            { 'name' : 'entity114', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard12',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity121', 'type' : 'entity' },
                            { 'name' : 'entity122', 'type' : 'entity' },
                            { 'name' : 'entity123', 'type' : 'entity' },
                            { 'name' : 'entity124', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member2',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard21',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity211', 'type' : 'entity' },
                            { 'name' : 'entity212', 'type' : 'entity' },
                            { 'name' : 'entity213', 'type' : 'entity' },
                            { 'name' : 'entity214', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard22',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity221', 'type' : 'entity' },
                            { 'name' : 'entity222', 'type' : 'entity' },
                            { 'name' : 'entity223', 'type' : 'entity' },
                            { 'name' : 'entity224', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard23',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity231', 'type' : 'entity' },
                            { 'name' : 'entity232', 'type' : 'entity' },
                            { 'name' : 'entity233', 'type' : 'entity' },
                            { 'name' : 'entity234', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member3',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard31',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity311', 'type' : 'entity' },
                            { 'name' : 'entity312', 'type' : 'entity' },
                            { 'name' : 'entity313', 'type' : 'entity' },
                            { 'name' : 'entity314', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard32',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity321', 'type' : 'entity' },
                            { 'name' : 'entity322', 'type' : 'entity' },
                            { 'name' : 'entity323', 'type' : 'entity' },
                            { 'name' : 'entity324', 'type' : 'entity' }
                        ]
                    },
                ]
            },
        ]
    }
}

setTimeout(update3, 10000);

function update3() {
  update(hierarchy3());
}

function hierarchy3() {
    return {
        'name' : 'cluster',
        'type' : 'cluster',
        'children' : [
            {
                'name' : 'member1',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard11',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity111', 'type' : 'entity' },
                            { 'name' : 'entity112', 'type' : 'entity' },
                            { 'name' : 'entity113', 'type' : 'entity' },
                            { 'name' : 'entity114', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard12',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity121', 'type' : 'entity' },
                            { 'name' : 'entity122', 'type' : 'entity' },
                            { 'name' : 'entity123', 'type' : 'entity' },
                            { 'name' : 'entity124', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member2',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard21',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity211', 'type' : 'entity' },
                            { 'name' : 'entity212', 'type' : 'entity' },
                            { 'name' : 'entity213', 'type' : 'entity' },
                            { 'name' : 'entity214', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard22',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity221', 'type' : 'entity' },
                            { 'name' : 'entity222', 'type' : 'entity' },
                            { 'name' : 'entity223', 'type' : 'entity' },
                            { 'name' : 'entity224', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member3',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard31',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity311', 'type' : 'entity' },
                            { 'name' : 'entity312', 'type' : 'entity' },
                            { 'name' : 'entity313', 'type' : 'entity' },
                            { 'name' : 'entity314', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard32',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity321', 'type' : 'entity' },
                            { 'name' : 'entity322', 'type' : 'entity' },
                            { 'name' : 'entity323', 'type' : 'entity' },
                            { 'name' : 'entity324', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member4',
                'type' : 'member',
                'children' : [
                  {
                      'name' : 'shard23',
                      'type' : 'shard',
                      'children' : [
                          { 'name' : 'entity231', 'type' : 'entity' },
                          { 'name' : 'entity232', 'type' : 'entity' },
                          { 'name' : 'entity233', 'type' : 'entity' },
                          { 'name' : 'entity234', 'type' : 'entity' }
                      ]
                  },
                ]
            },
        ]
    }
}

setTimeout(update4, 15000);

function update4() {
  update(hierarchy4());
}

function hierarchy4() {
    return {
        'name' : 'cluster',
        'type' : 'cluster',
        'children' : [
            {
                'name' : 'member1',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard11',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity111', 'type' : 'entity' },
                            { 'name' : 'entity112', 'type' : 'entity' },
                            { 'name' : 'entity113', 'type' : 'entity' },
                            { 'name' : 'entity114', 'type' : 'entity' },
                            { 'name' : 'entity115', 'type' : 'entity' },
                            { 'name' : 'entity116', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard12',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity121', 'type' : 'entity' },
                            { 'name' : 'entity123', 'type' : 'entity' },
                            { 'name' : 'entity124', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member2',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard21',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity211', 'type' : 'entity' },
                            { 'name' : 'entity212', 'type' : 'entity' },
                            { 'name' : 'entity213', 'type' : 'entity' },
                            { 'name' : 'entity214', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard22',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity221', 'type' : 'entity' },
                            { 'name' : 'entity222', 'type' : 'entity' },
                            { 'name' : 'entity223', 'type' : 'entity' },
                            { 'name' : 'entity224', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member3',
                'type' : 'member',
                'children' : [
                    {
                        'name' : 'shard31',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity311', 'type' : 'entity' },
                            { 'name' : 'entity312', 'type' : 'entity' },
                            { 'name' : 'entity313', 'type' : 'entity' },
                            { 'name' : 'entity314', 'type' : 'entity' }
                        ]
                    },
                    {
                        'name' : 'shard32',
                        'type' : 'shard',
                        'children' : [
                            { 'name' : 'entity321', 'type' : 'entity' },
                            { 'name' : 'entity322', 'type' : 'entity' },
                            { 'name' : 'entity323', 'type' : 'entity' },
                            { 'name' : 'entity324', 'type' : 'entity' }
                        ]
                    },
                ]
            },
            {
                'name' : 'member4',
                'type' : 'member',
                'children' : [
                  {
                      'name' : 'shard23',
                      'type' : 'shard',
                      'children' : [
                          { 'name' : 'entity231', 'type' : 'entity' },
                          { 'name' : 'entity232', 'type' : 'entity' },
                          { 'name' : 'entity233', 'type' : 'entity' },
                          { 'name' : 'entity234', 'type' : 'entity' }
                      ]
                  },
                ]
            },
        ]
    }
}

</script>
